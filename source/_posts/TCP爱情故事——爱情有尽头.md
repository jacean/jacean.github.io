---
title: TCP爱情故事——爱情有尽头
date: 2016-03-28 19:26:27
tags:
    - TCP
categories:
    - 网络
---
小T和小P过上了幸福的生活。就这样，过了xxx天。
因为一些原因(番外)，小T决定还是和小P分手。唉，真是可惜啊。
分手呢，是4条短信，也就是传说中的*四次挥手*。
<!-- more -->
原本呢，小T和小P是恋人，他们在恋爱期(ESTABLISHED)，但是，对吧，所以，继续咯。
小T在一番决心之后，终于还是发出了第一条短信。
> 我们分手吧。(FIN)

发完之后，小T就进入了主动提出分手的烦闷状态(FIN WAIT1)，一个人闷在被子里，可能在哭，也可能是在睡觉吧，反正我没掀开被子看。
小P呢，这傻孩子，虽然也发觉到了两人的感情情况有异了，但还是舍不得，更下不了决心。
这天，小P正在床上躺着，突然，嘟，短信提示音，小P伸手拿过手机一看，哦，原来是要分手。拿着手机的手突然无力，手机差点砸到脸上，他心里一阵难过。沉默中坐起身子，靠着床边，盯着手机，1秒，2秒，3秒，。。。(进入了CLOSE WAIT状态)。。。，就这样不知过了多久，他终于发出了消息。
> 我明白了，给我点时间。(ACK)

小P继续沉默(CLOSE WAIT)，可能是在回忆过去，也可能是在，谁知道呢，我怎么会直到他在想什么。
小T的短信提示音响了，被子里伸出一只手，摸索着找到了手机。可能是哭过，睁开红肿的眼睛看到了屏幕里的字，放下手机，闭上眼，趴在床上，就此无声(进入了FIN WAIT2状态)。

摄像机转回小P，这时他正拿着手机，慢慢打字。1个字，2个字，5个字，10个字，2个字，1个字，50个字，3个字，100个字，就这样发吧，那就这样吧。最后，他发出了短信(FIN)，把手机扔到一旁，打开了电视，声音开到很大很大，然后就没有他的声响了(进入了LAST ACK状态)。
> 好

小T看着只有1个字的短信，知道他们从此结束了。深呼吸，深呼吸，深呼吸，强作笑脸，给了自己一个微笑，想着再回复一条吧。(ACK)
> 那就这样吧，祝你幸福

一切都结束了，保持微笑，小T看着窗外的天空，很蓝，伸出手，阳光很温暖，想着，就是这么温暖的阳光，给了生命生机，孕育出了这美丽的世界吧。
手机放在身边，她在等，等到等不到小P再发来消息，那我们就真的这样了(这就进入了TIME WAIT状态)。

小P看着回复，祝我幸福，可能真的会幸福吧，可是再幸福也不会有你了，你的幸福也不会有我了。
终究还是分手了，长按关机，对着手机说，你也会幸福的，对吧。
双手交叉放在脖颈，躺倒床上，让我最后一次梦到你，梦到属于我们的幸福之后，再醒来，醒来享受没有你的幸福(进入了CLOSED状态)。

一小时，两小时，该吃饭了，你在吃饭么，５小时，看来你会很好的。对着快要落山的夕阳挥挥手，明天见。(CLOSED)

这段爱情有了自己的结局，也许不是我们期待的走上婚姻殿堂，但是也会是是曾经的幸福。

好了，剧情结束。
来好好说说ＴＣＰ的四次挥手。图如下
![](http://7xrtyi.com1.z0.glb.clouddn.com/hexoBlog_img_TCP-2.png)

先看第一条短信，小Ｔ说要分手，这是她主动提出要分手，因为她觉得没有感情了，对主机１来说，它提出要关闭连接，是因为没有数据要发送了。
第二条，小Ｐ收到后，自然直到小Ｔ是没感情了，但是他还有啊，所以他需要时间去在自己心里砍一刀。对主机２来说，就是主机１你发完了，我还有数据没发完呢，你给老子再等等。然后，小Ｔ就继续等，小Ｐ就继续砍，对应主机就是主机１等待主机２发送完毕数据，主机２继续腾空自己的数据。
第三条短信，小Ｐ处理完了自己的感情，觉得可以结束了，就告诉小Ｔ可以分手了。对应于主机２，就是它数据发送完毕了，可以关闭连接了。同时等待主机１来发送最后通牒。
第四条短信，小Ｔ收到后，那就分手吧，我说你那边可以确定分手了，别再跟人说你不是单身。然后就等着，看小Ｐ有没有收到我的确定消息，收到了就不会说话，我等待时间过了就自己也关闭，没收到可能还会瞎逼逼，我得再跟你说一次，咱们都是单身了。小Ｐ收到确定消息之后，就直接关闭连接，就此两清，等待下一次的爱情。主机１和主机２也是这样。

这里之所以是４条，就是因为小Ｐ可能想不明白，需要等他想明白，也就是主机１虽然没数据了，但是主机２可能还有，得等他发完再说。
不过，当小Ｐ也有这念头，主机２数据也正好发完，那就第２，３条短信合一块，直接分手了，直接关闭连接了。

还有就是，WAIT TIME，这里是主机１对网络环境保持怀疑，所以要通过２×MSL来自己确认主机２是真的没数据要发送了。

这就是我理解的四次挥手了，应该比较清晰了。如果哪里有不对，请指出来我再学习。

