---
title: TCP爱情故事——我们恋爱了
date: 2016-03-28 18:44:57
tags:
    - TCP
categories:
    - 网络
---
谈恋爱是两。。个。。人。。相互喜欢，然后表白，我喜欢你，你喜欢我，大家就开开心心的在一起了。
在这里，我来谈一谈被称为**TCP爱情**的小故事,
这场爱情因为3条短信成就，也就是大家盛传的*三次握手*。
主人公是小T和小P。一个大方勇敢的姑娘，一个腼腆有才的少年。现在他们都是单身狗状态(CLOSED).
然后结局是小T和小P在一起了，他们connect了，简称TCP。
故事开始了。。。
<!-- more -->
话说春天到了，小P看着人家小情侣成双成对的心里很是羡慕，然后就一直想啊，想啊，要是他 也有对象多好，小P有点害羞，不好意思去跟女孩说话，所以想着要是有人跟他表白该多好，只要看对眼就好啊。不管这想法有多天真，总之，小P是进入了发春状态(执行了LISTEN原语，进入Listen状态),渴望被爱。

小T这个姑娘啊，很不错，现在是单身。有一次莫名的邂逅(番外)之后，小T对小P有了莫名的思念，然后渐渐的，越来越关注小P，终于，发现自己喜欢上了虽然有些腼腆，但是可爱干净的小P。在一番纠结之后，小T终于还是决定，我要跟小P表白，我要跟他在一起。于是，勇敢找到小P的电话，发了条短信(执行了CONNECT原语)。

> T：我喜欢你。
> 我还没喜欢过人(SEQ=0,常规:seq=t),
> 你要做第一个吗?
> 
> *SYN同步信号(SEQ=0)*

发完之后，小T就进入了主动表白等待回应的状态(SYN SENT)。既担心又期待，小心脏扑通扑通的跳个不停，一直盯着手机，生怕错过了回复。
嘟，小P发现来短信了，拿起一看，瞬间一脸懵逼，然后仰天大笑，哥的春天到了。想着小T漂亮的脸蛋和巴拉巴拉(自行脑补)，这就是他的梦中女神型啊。于是，拿起手机，给小T回了句(执行ACCEPT原语)
> P:我也喜欢你.
> 我等你等了好久,我愿意做你第一个喜欢的人(ACK=1,常规:ack=t+1)，
> 我没有初恋，你愿意做我的初恋(SEQ=0,seq=p)吗。
> 
> *SYN同步信号(SEQ=0,ACK=0+1)*

发出去后，小P就进入了接受表白快要脱单的状态(SYN RCVD)。
小T在忐忑中终于等到了回应，鼓起勇气，深呼吸，拿起手机，闭上眼睛，点击确认，1，2，3，到底是什么。好开心，小P竟然也喜欢我，真的好开心，他还要和我在一起，太激动了，怎么办怎么办，要不要直接答应呢，好纠结，好烦啊，真是烦死人了，直接答应会不会很草率啊，他会不会对我好啊，想着想着短信就发出去了。
> T：好啊。
> 我是你的初恋，你也是我的初恋(常规:seq=t+1,ack=p+1)
> 
> SYN(SEQ=1,ACK=1)

于是，小T正式脱单了，进入了恋爱状态(ESTABLISHED)。很快，收到小T肯定回复的小P也知道自己终于脱单了，也进入了恋爱状态(ESTABLISHED)。
从此，小T和小P开始了亲密的互动，过上了幸福的生活，他们彼此连接在了一起，就是TCP。
这就是小T和小P的TCP爱情故事。

多么美好的结局，但是，现实总是残酷的。
剧情回到小P收到短信那一刻。

————————————————华丽丽的分割线—————————————————————

小P看着手机中的短信，“我喜欢你”，这四个字让他有点小激动，但是看到发送人，小T，他懵了，小T不是那个巴拉巴拉(自行脑补)的，一直人送外号“别人家的对象”的女孩吗，我还是不要喜欢她了，我要继续等我的女神。也就是，并没有看对眼，于是，回了句
> 你是个好人。

剧情到此结束，小T被拒绝了，收到了好人卡(RST标志位为1).


爱情，谁知道哪天就变了。下篇，小T和小P就要分手了，也就是释放连接，四次挥手。。。


然后，就来具体讲讲３次握手怎么握的了。
流程图就是下边这样咯
![](http://7xrtyi.com1.z0.glb.clouddn.com/hexoBlog_img_tcp-1.png)
第一条短信，小Ｔ说喜欢小Ｐ，这就是主动进行连接。主机１向主机２主动发出连接请求，进入同步发送状态，处于ｌｉｓｔｅｎ的主机２发现请求，并接受请求，于是就给回应准备好了。
第二条短信，小Ｐ也说喜欢，然后邀请在一起。就是主机２说咱可以连接，回复主机１的序号加１作为确认号，同时还会传送自己序号。然后进入同步接收状态。
第三条短信，小Ｔ给小Ｐ确认，两个人建立正式的关系。主机１和主机２也是，两边都问好之后就发送序号和确认号，建立连接。

ＴＣＰ是全双工的，也可能两端同时连接，这时候通过序号和确认号，最终建立的是一条连接，进行通信。

大体我理解的就是这样，有不对请指出。
